import{d as w,b as E,r as h,j as a,B,u as J,z as r,t as L}from"./index-tOR3AC1v.js";import{u as I,a as O,b as R,J as D,L as F,f as _,C as K,S as $,c as z,B as Q,X,d as q,e as U,g as V,h as G,i as W,j as A}from"./formatDuration-DJtpW71y.js";import{I as H}from"./input-BaUZ_Bls.js";const j=["web_staging","web_feature","web_production"],M=["checks","manual_deps_install",...j],Y=r.object({name:r.union([r.enum(M),r.literal("build")]),jobName:r.string(),duration:r.number(),date:r.string(),durationDisplay:r.string(),webPath:r.string()}),Z=50;function b({app:x}){var y,v;const{sliders:c,getTrimPercentage:l,getAppliedTrimming:p,trimSlidersStore:o}=I({name:"jobs"}),{auth:{domain:d}}=J(),m=O(),{data:n,isLoading:u,error:g}=R({queryKey:["jobs"],queryFn:()=>m(D,{app:x})});if(u)return a.jsx(F,{variant:"page"});if(g)return a.jsxs("div",{children:["Error: ",g.message]});if(!((v=(y=n==null?void 0:n.project)==null?void 0:y.pipelines)!=null&&v.nodes))return a.jsx("div",{children:"No data available"});const P=n.project.pipelines.nodes.flatMap(t=>{var s,i;return(i=(s=t==null?void 0:t.jobs)==null?void 0:s.nodes)==null?void 0:i.filter(e=>M.includes((e==null?void 0:e.name)??"nope")).map(e=>Y.parse({date:t.createdAt,duration:e==null?void 0:e.duration,durationDisplay:_({seconds:((e==null?void 0:e.duration)??0)%60,minutes:Math.floor(((e==null?void 0:e.duration)??0)/60)},{format:["minutes","seconds"]}),name:j.includes((e==null?void 0:e.name)??"nope")?"build":e==null?void 0:e.name,jobName:e==null?void 0:e.name,webPath:e==null?void 0:e.webPath}))}).filter(Boolean).toSorted((t,s)=>t.date.localeCompare(s.date)),f=Object.groupBy(P,t=>t.name);h.useEffect(()=>{const t=Object.keys(f);o.send({type:"initializeSliders",sources:t})},[n,o]);const T={duration:{label:"Duration",color:"#2563eb"},special:{label:"Upgrade (2025-05-22)",color:"#f43f5e"}};return a.jsxs("div",{className:"w-full",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Jobs durations"}),a.jsx(B,{variant:"outline",className:"cursor-pointer",size:"icon",onClick:()=>{navigator.clipboard.writeText(D.toString()),L.success("Query copied to clipboard",{position:"top-right"})},children:a.jsx(K,{className:"h-4 w-4"})}),a.jsx("hr",{className:"my-4"}),c.length>0&&Object.entries(f).map(([t,s])=>{const i=p(s,t);return[t,i.map(e=>e.date.startsWith("2025-05-22")?{...e,duration:0,special:e.duration}:e)]}).map(([t,s])=>{const i=s.reduce((e,C)=>e+C.duration,0)/s.length;return a.jsxs("div",{children:[a.jsxs("div",{className:"",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("p",{className:"shrink-0 text-lg text-gray-300",children:t})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Average duration:"," ",_({seconds:Math.floor(i%60),minutes:Math.floor(i/60)},{format:["minutes","seconds"]})]}),a.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Trim percentage ",l(t),"%"]}),a.jsx($,{min:0,max:Z,step:1,value:[l(t)],onValueChange:([e])=>{e!==void 0&&o.send({type:"updateSliderValue",source:t,value:e})}})]})]}),a.jsx(z,{config:T,children:a.jsxs(Q,{accessibilityLayer:!0,data:s,children:[a.jsx(X,{dataKey:"date",tickMargin:10,tickFormatter:e=>q(e,"d/MM")}),a.jsx(U,{content:a.jsx(V,{formatter:(e,C,N)=>{var S,k;return`${(S=N.payload)==null?void 0:S.jobName} ${(k=N.payload)==null?void 0:k.durationDisplay}`}})}),a.jsx(G,{content:a.jsx(W,{})}),a.jsx(A,{dataKey:"special",stackId:"a",fill:"var(--color-special)",radius:4}),a.jsx(A,{dataKey:"duration",stackId:"a",fill:"var(--color-duration)",radius:4,onClick:({payload:e})=>{e&&window.open(`https://${d}${e.webPath}`,"_blank")}})]})}),a.jsx("hr",{className:"my-4"})]},t)})]})}const se=function(){const{app:c}=w.useSearch(),l=E({from:w.fullPath}),[p,o]=h.useState(c!=="your-app"),[d,m]=h.useState(c);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx(H,{type:"text",placeholder:"App",value:d,onChange:n=>{const u=n.target.value;m(u),l({search:{app:u}})}}),a.jsx(B,{onClick:()=>o(!0),children:"Done"})]}),p?a.jsx(b,{app:d}):null]})};export{se as component};
