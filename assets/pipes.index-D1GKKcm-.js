import{a as b,r as _,z as c,j as e,B as w,t as T}from"./index-6ayg2Pbe.js";import{u as A,a as E,b as M,L as B,C as D,P as p,f as L,S as R,c as O,B as P,X as I,d as K,e as q,g as z,h as F,i as Q,j as h}from"./formatDuration-CTNnzF6g.js";const x=["push","merge_request_event","schedule","api","unknown"],X=50,J=function(){var u,m;const{app:g}=b.useSearch(),{sliders:j,getTrimPercentage:l,getAppliedTrimming:f,trimSlidersStore:i}=A({name:"pipes"}),y=E(),{data:r,isLoading:C,error:d}=M({queryKey:["pipes"],queryFn:()=>y(p,{app:g,cursor:void 0})});if(_.useEffect(()=>{var n,a;const t=(a=(n=r==null?void 0:r.project)==null?void 0:n.pipelines)==null?void 0:a.nodes,s=Array.from(new Set(t==null?void 0:t.map(o=>c.enum(x).parse((o==null?void 0:o.source)??"unknown"))));i.send({type:"initializeSliders",sources:s})},[r,i]),C)return e.jsx(B,{variant:"page"});if(d)return e.jsxs("div",{children:["Error: ",d.message]});if(!((m=(u=r==null?void 0:r.project)==null?void 0:u.pipelines)!=null&&m.nodes))return e.jsx("div",{children:"No data available"});const v={duration:{label:"Duration",color:"#2563eb"},special:{label:"Upgrade (2025-05-22)",color:"#f43f5e"}},N=r.project.pipelines.nodes.filter(Boolean).map(t=>{const s={...t,source:c.enum(x).parse(t.source??"unknown"),duration:c.number().parse(t.duration),date:t.createdAt};return s.date.startsWith("2025-05-22")?{...s,duration:0,special:s.duration}:s}).toSorted((t,s)=>t.date.localeCompare(s.date)),S=Object.groupBy(N,t=>t.source);return e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pipes durations"}),e.jsx(w,{variant:"outline",className:"cursor-pointer",size:"icon",onClick:()=>{navigator.clipboard.writeText(p.toString()),T.success("Query copied to clipboard",{position:"top-right"})},children:e.jsx(D,{className:"h-4 w-4"})}),e.jsx("hr",{className:"my-4"}),j.length>0&&Object.entries(S).map(([t,s])=>{const n=f(s,t);return[t,n]}).map(([t,s])=>{const n=s.reduce((a,o)=>a+o.duration,0)/s.length;return e.jsxs("div",{children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"shrink-0 text-lg text-gray-300",children:t})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Average duration:"," ",L({seconds:Math.floor(n%60),minutes:Math.floor(n/60)},{format:["minutes","seconds"]})]}),e.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Trim percentage ",l(t),"%"]}),e.jsx(R,{min:0,max:X,step:1,value:[l(t)],onValueChange:([a])=>{a!==void 0&&i.send({type:"updateSliderValue",source:t,value:a})}})]})]}),e.jsx(O,{config:v,children:e.jsxs(P,{accessibilityLayer:!0,data:s,children:[e.jsx(I,{dataKey:"date",tickMargin:10,tickFormatter:a=>K(a,"d/MM")}),e.jsx(q,{content:e.jsx(z,{formatter:(a,o,{payload:k})=>JSON.stringify(k,null,2)})}),e.jsx(F,{content:e.jsx(Q,{})}),e.jsx(h,{dataKey:"special",stackId:"a",fill:"var(--color-special)",radius:4}),e.jsx(h,{dataKey:"duration",stackId:"a",fill:"var(--color-duration)",radius:4,onClick:({payload:a})=>{a&&window.open(`https://${__DOMAIN__}${a.path}`,"_blank")}})]})}),e.jsx("hr",{className:"my-4"})]},t)})]})};export{J as component};
