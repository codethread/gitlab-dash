import{b as _,d as E,r as h,j as t,B as A,z as r,t as I}from"./index-DfbB8mwn.js";import{u as J,a as L,b as P,J as k,L as O,f as D,C as R,S as K,c as $,B as z,X as F,d as Q,e as X,g as q,h as U,i as V,j as w}from"./formatDuration-CatxRzAs.js";import{I as G}from"./input-DNIr5boh.js";const B=["web_staging","web_feature","web_production"],M=["checks","manual_deps_install",...B],W=r.object({name:r.union([r.enum(M),r.literal("build")]),jobName:r.string(),duration:r.number(),date:r.string(),durationDisplay:r.string(),webPath:r.string()}),H=50;function Y({app:x}){var f,y;const{sliders:l,getTrimPercentage:d,getAppliedTrimming:p,trimSlidersStore:o}=J({name:"jobs"}),u=L(),{data:n,isLoading:m,error:c}=P({queryKey:["jobs"],queryFn:()=>u(k,{app:x,cursor:void 0})});if(m)return t.jsx(O,{variant:"page"});if(c)return t.jsxs("div",{children:["Error: ",c.message]});if(!((y=(f=n==null?void 0:n.project)==null?void 0:f.pipelines)!=null&&y.nodes))return t.jsx("div",{children:"No data available"});const T=n.project.pipelines.nodes.flatMap(a=>{var s,i;return(i=(s=a==null?void 0:a.jobs)==null?void 0:s.nodes)==null?void 0:i.filter(e=>M.includes((e==null?void 0:e.name)??"nope")).map(e=>W.parse({date:a.createdAt,duration:e==null?void 0:e.duration,durationDisplay:D({seconds:((e==null?void 0:e.duration)??0)%60,minutes:Math.floor(((e==null?void 0:e.duration)??0)/60)},{format:["minutes","seconds"]}),name:B.includes((e==null?void 0:e.name)??"nope")?"build":e==null?void 0:e.name,jobName:e==null?void 0:e.name,webPath:e==null?void 0:e.webPath}))}).filter(Boolean).toSorted((a,s)=>a.date.localeCompare(s.date)),g=Object.groupBy(T,a=>a.name);h.useEffect(()=>{const a=Object.keys(g);o.send({type:"initializeSliders",sources:a})},[n,o]);const j={duration:{label:"Duration",color:"#2563eb"},special:{label:"Upgrade (2025-05-22)",color:"#f43f5e"}};return t.jsxs("div",{className:"w-full",children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Jobs durations"}),t.jsx(A,{variant:"outline",className:"cursor-pointer",size:"icon",onClick:()=>{navigator.clipboard.writeText(k.toString()),I.success("Query copied to clipboard",{position:"top-right"})},children:t.jsx(R,{className:"h-4 w-4"})}),t.jsx("hr",{className:"my-4"}),l.length>0&&Object.entries(g).map(([a,s])=>{const i=p(s,a);return[a,i.map(e=>e.date.startsWith("2025-05-22")?{...e,duration:0,special:e.duration}:e)]}).map(([a,s])=>{const i=s.reduce((e,v)=>e+v.duration,0)/s.length;return t.jsxs("div",{children:[t.jsxs("div",{className:"",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("p",{className:"shrink-0 text-lg text-gray-300",children:a})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Average duration:"," ",D({seconds:Math.floor(i%60),minutes:Math.floor(i/60)},{format:["minutes","seconds"]})]}),t.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Trim percentage ",d(a),"%"]}),t.jsx(K,{min:0,max:H,step:1,value:[d(a)],onValueChange:([e])=>{e!==void 0&&o.send({type:"updateSliderValue",source:a,value:e})}})]})]}),t.jsx($,{config:j,children:t.jsxs(z,{accessibilityLayer:!0,data:s,children:[t.jsx(F,{dataKey:"date",tickMargin:10,tickFormatter:e=>Q(e,"d/MM")}),t.jsx(X,{content:t.jsx(q,{formatter:(e,v,C)=>{var N,S;return`${(N=C.payload)==null?void 0:N.jobName} ${(S=C.payload)==null?void 0:S.durationDisplay}`}})}),t.jsx(U,{content:t.jsx(V,{})}),t.jsx(w,{dataKey:"special",stackId:"a",fill:"var(--color-special)",radius:4}),t.jsx(w,{dataKey:"duration",stackId:"a",fill:"var(--color-duration)",radius:4,onClick:({payload:e})=>{e&&window.open(`https://${__DOMAIN__}${e.webPath}`,"_blank")}})]})}),t.jsx("hr",{className:"my-4"})]},a)})]})}const te=function(){const{app:l}=_.useSearch(),d=E({from:_.fullPath}),[p,o]=h.useState(l!=="your-app"),[u,n]=h.useState(l);return p?t.jsx(Y,{app:u}):t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(G,{type:"text",placeholder:"App",value:u,onChange:m=>{const c=m.target.value;n(c),d({search:{app:c}})}}),t.jsx(A,{onClick:()=>o(!0),children:"Done"})]})};export{te as component};
