import{a as v,b as T,r as x,j as e,B as k,u as D,z as h,t as E}from"./index-tOR3AC1v.js";import{u as _,a as B,b as M,L,C as R,P as C,f as I,S as F,c as K,B as O,X as q,d as z,e as Q,g as X,h as U,i as V,j as N}from"./formatDuration-DJtpW71y.js";import{I as $}from"./input-BaUZ_Bls.js";const S=["push","merge_request_event","schedule","api","unknown"],G=50;function J({app:g}){var f,y;const{sliders:c,getTrimPercentage:l,getAppliedTrimming:p,trimSlidersStore:i}=_({name:"pipes"}),{auth:{domain:d}}=D(),m=B(),{data:r,isLoading:u,error:j}=M({queryKey:["pipes"],queryFn:()=>m(C,{app:g})});if(x.useEffect(()=>{var n,a;const t=(a=(n=r==null?void 0:r.project)==null?void 0:n.pipelines)==null?void 0:a.nodes,s=Array.from(new Set(t==null?void 0:t.map(o=>h.enum(S).parse((o==null?void 0:o.source)??"unknown"))));i.send({type:"initializeSliders",sources:s})},[r,i]),u)return e.jsx(L,{variant:"page"});if(j)return e.jsxs("div",{children:["Error: ",j.message]});if(!((y=(f=r==null?void 0:r.project)==null?void 0:f.pipelines)!=null&&y.nodes))return e.jsx("div",{children:"No data available"});const b={duration:{label:"Duration",color:"#2563eb"},special:{label:"Upgrade (2025-05-22)",color:"#f43f5e"}},A=r.project.pipelines.nodes.filter(Boolean).map(t=>{const s={...t,source:h.enum(S).parse(t.source??"unknown"),duration:h.number().parse(t.duration),date:t.createdAt};return s.date.startsWith("2025-05-22")?{...s,duration:0,special:s.duration}:s}).toSorted((t,s)=>t.date.localeCompare(s.date)),w=Object.groupBy(A,t=>t.source);return e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pipes durations"}),e.jsx(k,{variant:"outline",className:"cursor-pointer",size:"icon",onClick:()=>{navigator.clipboard.writeText(C.toString()),E.success("Query copied to clipboard",{position:"top-right"})},children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx("hr",{className:"my-4"}),c.length>0&&Object.entries(w).map(([t,s])=>{const n=p(s,t);return[t,n]}).map(([t,s])=>{const n=s.reduce((a,o)=>a+o.duration,0)/s.length;return e.jsxs("div",{children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"shrink-0 text-lg text-gray-300",children:t})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Average duration:"," ",I({seconds:Math.floor(n%60),minutes:Math.floor(n/60)},{format:["minutes","seconds"]})]}),e.jsxs("p",{className:"shrink-0 text-sm text-gray-500",children:["Trim percentage ",l(t),"%"]}),e.jsx(F,{min:0,max:G,step:1,value:[l(t)],onValueChange:([a])=>{a!==void 0&&i.send({type:"updateSliderValue",source:t,value:a})}})]})]}),e.jsx(K,{config:b,children:e.jsxs(O,{accessibilityLayer:!0,data:s,children:[e.jsx(q,{dataKey:"date",tickMargin:10,tickFormatter:a=>z(a,"d/MM")}),e.jsx(Q,{content:e.jsx(X,{formatter:(a,o,{payload:P})=>JSON.stringify(P,null,2)})}),e.jsx(U,{content:e.jsx(V,{})}),e.jsx(N,{dataKey:"special",stackId:"a",fill:"var(--color-special)",radius:4}),e.jsx(N,{dataKey:"duration",stackId:"a",fill:"var(--color-duration)",radius:4,onClick:({payload:a})=>{a&&window.open(`https://${d}${a.path}`,"_blank")}})]})}),e.jsx("hr",{className:"my-4"})]},t)})]})}const ee=function(){const{app:c}=v.useSearch(),l=T({from:v.fullPath}),[p,i]=x.useState(c!=="your-app"),[d,m]=x.useState(c);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx($,{type:"text",placeholder:"App",value:d,onChange:r=>{const u=r.target.value;m(u),l({search:{app:u}})}}),e.jsx(k,{onClick:()=>i(!0),children:"Done"})]}),p?e.jsx(J,{app:d}):null]})};export{ee as component};
